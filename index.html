<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</title>
<script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
<style>
Â  @import url('https://fonts.googleapis.com/css2?family=Tajawal&display=swap');
Â  body{font-family:"Tajawal",sans-serif;direction:rtl;background-color:#f0f8ff;margin:0;padding:0;}
Â  h2{text-align:center;color:#0d6efd;margin:20px 0;}
Â  .container{width:100%;padding:20px;box-sizing:border-box;}
Â  form{background-color:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.1);margin-bottom:20px;}
Â  label{display:block;margin-top:10px;font-weight:bold;color:#333;}
Â  input{width:100%;padding:10px;margin-top:5px;border-radius:8px;border:1px solid #ccc;box-sizing:border-box;}
Â  button{margin-top:10px;padding:10px 16px;cursor:pointer;border:none;border-radius:8px;background-color:#0d6efd;color:#fff;font-weight:bold;transition:0.3s;}
Â  button:hover{background-color:#084298;}
Â  #reader{width:100%;max-width:400px;margin:20px auto;display:none;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
Â  .table-container{width:100%;overflow-x:auto;}
Â  table{width:100%;border-collapse:collapse;table-layout:fixed;font-size:10px;margin:0;}
Â  th,td{padding:8px;text-align:center;border:1px solid #ccc;overflow-wrap:break-word;white-space:normal;}
Â  th{background-color:#0d6efd;color:#fff;cursor:pointer;}
Â  tr:nth-child(even){background-color:#e7f1ff;}
Â  tr:hover{background-color:#d0e4ff;}
Â  td.actions{white-space:nowrap;}
Â  .action-buttons{display:flex;gap:5px;justify-content:center;transform:translateX(-10px);}
Â  .search,.sort,.export,.import{margin:10px 0;padding:10px;border-radius:8px;border:1px solid #ccc;box-sizing:border-box;}
Â  .export{background-color:#808080;color:#fff;}
Â  .export:hover{background-color:#5e5e5e;}
Â  #successMark{
Â Â Â  position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
Â Â Â  font-size:70px;color:#28a745;display:none;animation:pop 0.4s ease;
Â  }
Â  @keyframes pop{0%{transform:scale(0.5) translate(-50%,-50%);opacity:0;}100%{transform:scale(1) translate(-50%,-50%);opacity:1;}}
Â  @media(max-width:768px){input,button,.search,.sort,.export,.import{width:100%;margin-top:10px;}}
</style>
</head>
<body>
<h2>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h2>
<div class="container">
<form id="itemForm">
Â  <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù:</label>
Â  <input type="text" id="itemName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù" required>

Â  <label>Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù (Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ QR):</label>
Â  <div style="display:flex;gap:10px;flex-wrap:wrap;">
Â Â Â  <input type="text" id="itemCode" placeholder="Ø§Ù…Ø³Ø­ Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ù…Ø²" style="flex:1;" required>
Â Â Â  <button type="button" id="scanBtn">ğŸ“· Ù…Ø³Ø­</button>
Â  </div>
Â  <div id="reader"></div>

Â  <label>Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
Â  <input type="text" id="itemUnit" placeholder="Ø§Ù„ÙˆØ­Ø¯Ø© Ù…Ø«Ù„: Ø­Ø¨Ø©ØŒ ÙƒÙŠÙ„ÙˆØŒ Ù„ØªØ±" required>

Â  <label>Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡:</label>
Â  <input type="number" id="itemCost" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡">

Â  <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹:</label>
Â  <input type="number" id="itemPrice" placeholder="Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹">

Â  <button type="submit">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
</form>

<input type="text" class="search" id="searchInput" placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙŠ ØµÙ†Ù">

<div style="display:flex;gap:10px;flex-wrap:wrap;">
Â  <select id="sortSelect" class="sort">
Â Â Â  <option value="">-- ÙØ±Ø² Ø­Ø³Ø¨ --</option>
Â Â Â  <option value="name-asc">Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù ØªØµØ§Ø¹Ø¯ÙŠ</option>
Â Â Â  <option value="name-desc">Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù ØªÙ†Ø§Ø²Ù„ÙŠ</option>
Â Â Â  <option value="code-asc">Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù ØªØµØ§Ø¹Ø¯ÙŠ</option>
Â Â Â  <option value="code-desc">Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù ØªÙ†Ø§Ø²Ù„ÙŠ</option>
Â Â Â  <option value="cost-asc">Ø£Ù‚Ù„ Ø³Ø¹Ø± Ø´Ø±Ø§Ø¡</option>
Â Â Â  <option value="cost-desc">Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø´Ø±Ø§Ø¡</option>
Â Â Â  <option value="price-asc">Ø£Ù‚Ù„ Ø³Ø¹Ø± Ø¨ÙŠØ¹</option>
Â Â Â  <option value="price-desc">Ø£Ø¹Ù„Ù‰ Ø³Ø¹Ø± Ø¨ÙŠØ¹</option>
Â  </select>

Â  <button class="export" id="exportExcel">ğŸ“„ ØªØµØ¯ÙŠØ± Excel</button>
Â  <button class="export" id="exportPDF">ğŸ“„ ØªØµØ¯ÙŠØ± PDF</button>
Â  <input type="file" id="importExcel" class="import" accept=".xlsx,.xls">
</div>

<div class="table-container">
<table id="itemsTable">
Â  <thead>
Â Â Â  <tr>
Â Â Â Â Â  <th style="width:25%;">Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
Â Â Â Â Â  <th style="width:15%;">Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù</th>
Â Â Â Â Â  <th style="width:15%;">Ø§Ù„ÙˆØ­Ø¯Ø©</th>
Â Â Â Â Â  <th style="width:15%;">Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡</th>
Â Â Â Â Â  <th style="width:15%;">Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
Â Â Â Â Â  <th style="width:15%;">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
Â Â Â  </tr>
Â  </thead>
Â  <tbody></tbody>
</table>
</div>

<audio id="beep" src="https://www.soundjay.com/button/sounds/beep-07.mp3" preload="auto"></audio>
<div id="successMark">âœ…</div>

<script>
const itemForm=document.getElementById("itemForm"),tableBody=document.querySelector("#itemsTable tbody");
const itemName=document.getElementById("itemName"),itemCode=document.getElementById("itemCode");
const itemUnit=document.getElementById("itemUnit"),itemCost=document.getElementById("itemCost"),itemPrice=document.getElementById("itemPrice");
const searchInput=document.getElementById("searchInput"),sortSelect=document.getElementById("sortSelect");
const importExcel=document.getElementById("importExcel"),successMark=document.getElementById("successMark");
const beep=document.getElementById("beep");
let editIndex=null;

function showSuccess(){beep.play();successMark.style.display="block";setTimeout(()=>successMark.style.display="none",2000);}

function loadItems(){
Â  tableBody.innerHTML="";
Â  let items=JSON.parse(localStorage.getItem("items")||"[]");
Â  const sortValue=sortSelect.value;
Â  if(sortValue){
Â Â Â  const [field,order]=sortValue.split("-");
Â Â Â  items.sort((a,b)=>{
Â Â Â Â Â  if(field==="name"||field==="code")return order==="asc"?a[field].localeCompare(b[field]):b[field].localeCompare(a[field]);
Â Â Â Â Â  return order==="asc"?a[field]-b[field]:b[field]-a[field];
Â Â Â  });
Â  }
Â  items.forEach((it,i)=>{
Â Â Â  const tr=document.createElement("tr");
Â Â Â  tr.innerHTML=`<td>${it.name}</td>
Â Â Â Â Â  <td>${it.code}</td>
Â Â Â Â Â  <td>${it.unit}</td>
Â Â Â Â Â  <td>${it.cost||''}</td>
Â Â Â Â Â  <td>${it.price||''}</td>
Â Â Â Â Â  <td class="actions">
Â Â Â Â Â Â Â  <div class="action-buttons">
Â Â Â Â Â Â Â Â Â  <button onclick="editItem(${i})">âœï¸ ØªØ¹Ø¯ÙŠÙ„</button>
Â Â Â Â Â Â Â Â Â  <button onclick="deleteItem(${i})" style="background-color:#dc3545;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
Â Â Â Â Â Â Â  </div>
Â Â Â Â Â  </td>`;
Â Â Â  tableBody.appendChild(tr);
Â  });
}

itemForm.addEventListener("submit",e=>{
Â  e.preventDefault();
Â  const items=JSON.parse(localStorage.getItem("items")||"[]");
Â  const nameExists=items.some((it,i)=>it.name===itemName.value&&i!==editIndex);
Â  const codeExists=items.some((it,i)=>it.code===itemCode.value&&i!==editIndex);
Â  if(codeExists)return alert("Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§");
Â  if(nameExists&&!confirm("Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ù…ÙˆØ¬ÙˆØ¯! Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ØŸ"))return;
Â  const costVal=Number(itemCost.value||0),priceVal=Number(itemPrice.value||0);
Â  if(costVal&&priceVal&&priceVal<costVal&&!confirm("Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹ Ø£Ù‚Ù„ Ù…Ù† Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡! Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø±ØŸ"))return;

Â  const newItem={name:itemName.value,code:itemCode.value,unit:itemUnit.value,cost:itemCost.value,price:itemPrice.value};
Â  if(editIndex!==null){items[editIndex]=newItem;editIndex=null;}else items.push(newItem);
Â  localStorage.setItem("items",JSON.stringify(items));
Â  itemForm.reset();loadItems();showSuccess();
});

window.editItem=i=>{
Â  const it=JSON.parse(localStorage.getItem("items"))[i];
Â  itemName.value=it.name;itemCode.value=it.code;itemUnit.value=it.unit;itemCost.value=it.cost;itemPrice.value=it.price;
Â  editIndex=i;
};

window.deleteItem=i=>{
Â  if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ")){
Â Â Â  const items=JSON.parse(localStorage.getItem("items")||"[]");
Â Â Â  items.splice(i,1);
Â Â Â  localStorage.setItem("items",JSON.stringify(items));
Â Â Â  loadItems();
Â  }
};

searchInput.addEventListener("input",()=>{
Â  const f=searchInput.value.toLowerCase();
Â  document.querySelectorAll("#itemsTable tbody tr").forEach(r=>{
Â Â Â  r.style.display=r.innerText.toLowerCase().includes(f)?"":"none";
Â  });
});
sortSelect.addEventListener("change",loadItems);

document.getElementById("exportExcel").addEventListener("click",()=>{
Â  const ws=XLSX.utils.json_to_sheet(JSON.parse(localStorage.getItem("items")||"[]"));
Â  const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"Ø§Ù„Ø£ØµÙ†Ø§Ù");
Â  XLSX.writeFile(wb,"Items.xlsx");
});
document.getElementById("exportPDF").addEventListener("click",()=>{
Â  const items=JSON.parse(localStorage.getItem("items")||"[]");
Â  const body=[['Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù','Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù','Ø§Ù„ÙˆØ­Ø¯Ø©','Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡','Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹']];
Â  items.forEach(it=>body.push([it.name,it.code,it.unit,it.cost||'',it.price||'']));
Â  pdfMake.createPdf({content:[{table:{headerRows:1,widths:['*','*','*','*','*'],body}}]}).download("Items.pdf");
});

importExcel.addEventListener("change",e=>{
Â  const f=e.target.files[0];if(!f)return;
Â  const reader=new FileReader();
Â  reader.onload=ev=>{
Â Â Â  const data=new Uint8Array(ev.target.result);
Â Â Â  const wb=XLSX.read(data,{type:'array'});
Â Â Â  const ws=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
Â Â Â  let items=JSON.parse(localStorage.getItem("items")||"[]");
Â Â Â  ws.forEach(it=>items.push({
Â Â Â Â Â  name:it['Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù']||it['name']||'',
Â Â Â Â Â  code:it['Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù']||it['code']||'',
Â Â Â Â Â  unit:it['Ø§Ù„ÙˆØ­Ø¯Ø©']||it['unit']||'',
Â Â Â Â Â  cost:it['Ø³Ø¹Ø± Ø§Ù„Ø´Ø±Ø§Ø¡']||it['cost']||'',
Â Â Â Â Â  price:it['Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹']||it['price']||''
Â Â Â  }));
Â Â Â  localStorage.setItem("items",JSON.stringify(items));
Â Â Â  loadItems();showSuccess();alert("ØªÙ… Ø§Ù„Ø¥Ø³ØªÙŠØ±Ø§Ø¯ âœ…");
Â  };
Â  reader.readAsArrayBuffer(f);
});

// QR Scanner
const scanBtn=document.getElementById("scanBtn"),reader=document.getElementById("reader");
const html5QrCode=new Html5Qrcode("reader");let isScanning=false;
scanBtn.addEventListener("click",async()=>{
Â  if(!isScanning){
Â Â Â  const cameras=await Html5Qrcode.getCameras();
Â Â Â  if(cameras && cameras.length){
Â Â Â Â Â  let cameraId=cameras.find(c=>c.label.toLowerCase().includes("back"))?.id || cameras[cameras.length-1].id;
Â Â Â Â Â  reader.style.display="block";
Â Â Â Â Â  html5QrCode.start(cameraId,{fps:15,qrbox:{width:300,height:150}},decodedText=>{
Â Â Â Â Â Â Â  itemCode.value=decodedText;showSuccess();html5QrCode.stop();reader.style.display="none";isScanning=false;scanBtn.textContent="ğŸ“· Ù…Ø³Ø­";
Â Â Â Â Â  });
Â Â Â Â Â  isScanning=true;scanBtn.textContent="â¹ï¸ Ø¥ÙŠÙ‚Ø§Ù";
Â Â Â  }
Â  }else{html5QrCode.stop();reader.style.display="none";isScanning=false;scanBtn.textContent="ğŸ“· Ù…Ø³Ø­";}
});

loadItems();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¹Ø±Ø¨ÙŠØªÙŠ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Tajawal&display=swap');
body{font-family:"Tajawal",sans-serif;direction:rtl;background-color:#f0f8ff;margin:0;padding:0;}
h2{text-align:center;color:#0d6efd;margin:20px 0;}
.container{width:100%;padding:20px;box-sizing:border-box;}
input, button{padding:10px;border-radius:8px;border:1px solid #ccc;font-size:14px;}
button{cursor:pointer;background-color:#0d6efd;color:#fff;border:none;margin-top:5px;}
button:hover{background-color:#084298;}
#suggestions{background:#fff;position:absolute;z-index:1000;width:100%;border:1px solid #ccc;border-radius:8px;display:none;max-height:150px;overflow-y:auto;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;white-space:normal;overflow-wrap:break-word;}
th{background-color:#0d6efd;color:#fff;}
tr:nth-child(even){background-color:#e7f1ff;}
tr:hover{background-color:#d0e4ff;}
.action-buttons{display:flex;gap:5px;justify-content:center;}
#summary{margin-top:10px;font-weight:bold;}
#previousCartsContainer div{margin-bottom:15px;}
#exitPreviousCartsBtn{margin:10px;background-color:#dc3545;color:#fff;padding:10px;border:none;border-radius:8px;cursor:pointer;}
</style>
</head>
<body>

<h2>ğŸ›’ Ø¹Ø±Ø¨ÙŠØªÙŠ</h2>

<!-- Ø²Ø± Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø¸Ø§Ù‡Ø± Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
<button id="exitPreviousCartsBtn" style="display:none;">âŒ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø¹Ø±Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</button>

<div class="container">

<label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ø£Ùˆ Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù:</label>
<div style="position:relative;display:flex;gap:10px;">
  <input type="text" id="searchItem" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù…Ø³Ø­ Ø§Ù„Ø±Ù…Ø²" style="flex:1;" autocomplete="off">
  <div id="suggestions"></div>
  <button type="button" id="scanBtn">ğŸ“· Ù…Ø³Ø­</button>
</div>

<div id="itemInfo" style="display:none;margin-top:10px;">
  <p>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù: <span id="infoName"></span></p>
  <p>Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù: <span id="infoCode"></span></p>
  <p>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹: <span id="infoPrice"></span></p>
  <label>Ø§Ù„ÙƒÙ…ÙŠØ©:</label>
  <input type="number" id="itemQty" value="1" min="1" style="width:80px;">
  <button id="addCartBtn">â• Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¹Ø±Ø¨Ø©</button>
</div>

<table id="cartTable">
  <thead>
    <tr>
      <th>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
      <th>Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù</th>
      <th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
      <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
      <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
      <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<div id="summary">Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹: 0 | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0</div>

<button id="saveCartBtn">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø©</button>
<button id="newCartBtn">ğŸ†• Ø¥Ø¶Ø§ÙØ© Ø³Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
<button id="previousCartsBtn">ğŸ“‚ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>

<div id="previousCartsContainer" style="display:none;"></div>

<script>
// Ø¨ÙŠØ§Ù†Ø§Øª Ø£ØµÙ†Ø§Ù ØªØ¬Ø±ÙŠØ¨ÙŠØ©
const items=[
  {name:"Ø­Ù„ÙŠØ¨ Ø¨Ù‚Ø±ÙŠ ÙƒØ¨ÙŠØ±", code:"001", price:200},
  {name:"Ø¹ØµÙŠØ± Ø±Ø§Ù†ÙŠ", code:"002", price:500},
  {name:"Ø¨Ø³ÙƒÙˆÙŠØª", code:"003", price:600}
];

let cart=[];
const searchItem=document.getElementById("searchItem");
const suggestions=document.getElementById("suggestions");
const itemInfo=document.getElementById("itemInfo");
const infoName=document.getElementById("infoName");
const infoCode=document.getElementById("infoCode");
const infoPrice=document.getElementById("infoPrice");
const itemQty=document.getElementById("itemQty");
const addCartBtn=document.getElementById("addCartBtn");
const cartTableBody=document.querySelector("#cartTable tbody");
const summary=document.getElementById("summary");

const saveCartBtn=document.getElementById("saveCartBtn");
const newCartBtn=document.getElementById("newCartBtn");
const previousCartsBtn=document.getElementById("previousCartsBtn");
const exitPreviousCartsBtn=document.getElementById("exitPreviousCartsBtn");
const previousCartsContainer=document.getElementById("previousCartsContainer");

let selectedItem=null;
let username = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:")||"guest";

// Ø¨Ø­Ø« ØªÙØ§Ø¹Ù„ÙŠ
searchItem.addEventListener("input",()=>{
  const val=searchItem.value.trim().toLowerCase();
  if(!val){ suggestions.style.display="none"; return; }
  const matches=items.filter(it=>it.name.toLowerCase().includes(val) || it.code.toLowerCase().includes(val));
  if(matches.length===0){ suggestions.style.display="none"; return; }
  suggestions.innerHTML=matches.map(it=>`<div style="padding:5px;cursor:pointer;" onclick='selectItem(${JSON.stringify(it)})'>${it.name} | ${it.code}</div>`).join('');
  suggestions.style.display="block";
});

function selectItem(item){
  searchItem.value=item.name;
  suggestions.style.display="none";
  showItem(item);
}

function showItem(item){
  selectedItem=item;
  infoName.textContent=item.name;
  infoCode.textContent=item.code;
  infoPrice.textContent=item.price;
  itemQty.value=1;
  itemInfo.style.display="block";
}

// Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¹Ø±Ø¨Ø©
addCartBtn.addEventListener("click",()=>{
  if(!selectedItem) return;
  const qty=Number(itemQty.value);
  if(qty<1) return;
  const existing=cart.find(c=>c.code===selectedItem.code);
  if(existing) existing.qty+=qty;
  else cart.push({name:selectedItem.name,code:selectedItem.code,price:selectedItem.price,qty});
  updateCartTable();
  itemInfo.style.display="none";
  searchItem.value="";
  selectedItem=null;
});

function updateCartTable(){
  cartTableBody.innerHTML="";
  let totalQty=0,totalPrice=0;
  cart.forEach((c,i)=>{
    const subtotal=c.price*c.qty;
    totalQty+=c.qty; totalPrice+=subtotal;
    const row=document.createElement("tr");
    row.innerHTML=`<td>${c.name}</td><td>${c.code}</td><td>${c.price}</td><td>${c.qty}</td><td>${subtotal}</td>
    <td class="action-buttons">
      <button onclick="deleteCartItem(${i})" style="background-color:#dc3545;">ğŸ—‘ï¸ Ø­Ø°Ù</button>
    </td>`;
    cartTableBody.appendChild(row);
  });
  summary.textContent=`Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹: ${totalQty} | Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${totalPrice}`;
}

function deleteCartItem(index){
  cart.splice(index,1);
  updateCartTable();
}

// Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ Ø§Ù„Ø­Ù‚Ù„
document.addEventListener("click",e=>{
  if(e.target!==searchItem) suggestions.style.display="none";
});

// Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø©
saveCartBtn.addEventListener("click",()=>{
  if(cart.length===0){ alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ± Ù„Ø­ÙØ¸Ù‡Ø§!"); return; }
  let allCarts=JSON.parse(localStorage.getItem(`userCarts_${username}`)||"[]");
  const newId=allCarts.length+1;
  const now=new Date();
  const dateStr=now.toLocaleString("ar-YE",{hour12:false});
  const newCart={id:newId,date:dateStr,items:JSON.parse(JSON.stringify(cart))};
  allCarts.push(newCart);
  localStorage.setItem(`userCarts_${username}`,JSON.stringify(allCarts));
  cart=[];
  updateCartTable();
  alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø© âœ…");
});

// Ø¥Ø¶Ø§ÙØ© Ø³Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
newCartBtn.addEventListener("click",()=>{
  if(cart.length===0){ cart=[]; updateCartTable(); alert("ØªÙ… ÙØªØ­ Ø³Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© âœ…"); return; }
  const saveCurrent = confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©ØŸ");
  if(saveCurrent){
    let allCarts=JSON.parse(localStorage.getItem(`userCarts_${username}`)||"[]");
    const newId=allCarts.length+1;
    const now=new Date();
    const dateStr=now.toLocaleString("ar-YE",{hour12:false});
    const newCart={id:newId,date:dateStr,items:JSON.parse(JSON.stringify(cart))};
    allCarts.push(newCart);
    localStorage.setItem(`userCarts_${username}`,JSON.stringify(allCarts));
    alert("ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø³Ù„Ø© âœ…");
  }
  cart=[]; updateCartTable(); alert("ØªÙ… ÙØªØ­ Ø³Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© âœ…");
});

// Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
previousCartsBtn.addEventListener("click",()=>{
  document.querySelector(".container").style.display="none"; 
  previousCartsContainer.style.display="block"; 
  exitPreviousCartsBtn.style.display="inline-block"; 
  displayPreviousCarts();
});

function displayPreviousCarts(){
  let allCarts=JSON.parse(localStorage.getItem(`userCarts_${username}`)||"[]");
  if(allCarts.length===0){ 
    previousCartsContainer.innerHTML="<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±Ø¨ÙŠØ§Øª Ù…Ø­ÙÙˆØ¸Ø©.</p>"; 
    return; 
  }
  previousCartsContainer.innerHTML="";
  allCarts.forEach(cart=>{
    const div=document.createElement("div");
    div.style.background="#fff";
    div.style.padding="10px";
    div.style.marginBottom="15px";
    div.style.borderRadius="12px";
    div.style.boxShadow="0 4px 12px rgba(0,0,0,0.1)";

    let tableHTML=`<p><strong>Ø±Ù‚Ù… Ø§Ù„Ø³Ù„Ø©:</strong> ${cart.id} | <strong>Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª:</strong> ${cart.date}</p>`;
    tableHTML+=`<div style="overflow-x:auto;"><table><thead>
      <tr>
        <th>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</th>
        <th>Ø±Ù…Ø² Ø§Ù„ØµÙ†Ù</th>
        <th>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</th>
        <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
        <th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th>
      </tr></thead><tbody>`;

    let totalQty=0, totalPrice=0;
    cart.items.forEach(it=>{
      const subtotal=it.price*it.qty;
      totalQty+=it.qty;
      totalPrice+=subtotal;
      tableHTML+=`<tr>
        <td>${it.name}</td>
        <td>${it.code}</td>
        <td>${it.price}</td>
        <td>${it.qty}</td>
        <td>${subtotal}</td>
      </tr>`;
    });

    tableHTML+=`</tbody></table></div>`;
    tableHTML+=`<p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹:</strong> ${totalQty} | <strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${totalPrice}</p>`;
    div.innerHTML=tableHTML;
    previousCartsContainer.appendChild(div);
  });
}

// Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ âŒ
exitPreviousCartsBtn.addEventListener("click",()=>{
  previousCartsContainer.style.display="none";
  document.querySelector(".container").style.display="block";
  exitPreviousCartsBtn.style.display="none";
});

// Ù…Ø³Ø­ QR (Ù…Ø³ØªÙ‚Ø¨Ù„ÙŠ)
const scanBtn=document.getElementById("scanBtn");
scanBtn.addEventListener("click",async()=>{ alert("Ù…ÙŠØ²Ø© Ø§Ù„Ù…Ø³Ø­ ÙŠÙ…ÙƒÙ† Ø§Ø¶Ø§ÙØªÙ‡Ø§ Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø¨Ù†ÙØ³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¨Ø­Ø«"); });

</script>

</body>
    </html>
